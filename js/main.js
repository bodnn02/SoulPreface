order_list = [
    {
        id: 1,
        title: "Топ + Брюки",
        price: 3500,
        colors: [
            {
                id: 1,
                title: "black",
                color_code: "#323232",
                gallery_items: [
                    {
                        id: 1,
                        src: "img/order-gallery-6.png"
                    },
                    {
                        id: 2,
                        src: "img/order-gallery-7.png"
                    },
                    {
                        id: 3,
                        src: "img/order-gallery-8.png"
                    },
                    {
                        id: 4,
                        src: "img/order-gallery-9.png"
                    },
                    {
                        id: 5,
                        src: "img/order-gallery-10.png"
                    },
                ],
                preview_src: "img/order-preview-1.jpg"
            },
            {
                id: 2,
                title: "white",
                color_code: "#fff",
                gallery_items: [
                    {
                        id: 1,
                        src: "img/order-gallery-1.png"
                    },
                    {
                        id: 2,
                        src: "img/order-gallery-2.png"
                    },
                    {
                        id: 3,
                        src: "img/order-gallery-3.png"
                    },
                    {
                        id: 4,
                        src: "img/order-gallery-4.png"
                    },
                    {
                        id: 5,
                        src: "img/order-gallery-5.png"
                    },
                ],
                preview_src: "img/order-preview-2.jpg"
            }
        ],
        characteristics: [
            {
                id: 1,
                title: "XS",
                content: [
                    {
                        id: 1,
                        title: "Обхват груди:",
                        value: "89 см"
                    },
                    {
                        id: 2,
                        title: "Обхват талии:",
                        value: "70 см"
                    },
                    {
                        id: 3,
                        title: "Обхват бедер:",
                        value: "98 см"
                    },
                ]
            },
            {
                id: 2,
                title: "S",
                content: [
                    {
                        id: 1,
                        title: "Обхват груди:",
                        value: "89 см"
                    },
                    {
                        id: 2,
                        title: "Обхват талии:",
                        value: "70 см"
                    },
                    {
                        id: 3,
                        title: "Обхват бедер:",
                        value: "98 см"
                    },
                ]
            },
            {
                id: 3,
                title: "M",
                content: [
                    {
                        id: 1,
                        title: "Обхват груди:",
                        value: "89 см"
                    },
                    {
                        id: 2,
                        title: "Обхват талии:",
                        value: "70 см"
                    },
                    {
                        id: 3,
                        title: "Обхват бедер:",
                        value: "98 см"
                    },
                ]
            }
        ]
    },
    {
        id: 2,
        title: "Лонгслив + Брюки",
        price: 3500,
        colors: [
            {
                id: 1,
                title: "black",
                color_code: "#323232",
                gallery_items: [
                    {
                        id: 1,
                        src: "img/order-gallery-11.png"
                    },
                    {
                        id: 2,
                        src: "img/order-gallery-12.png"
                    },
                    {
                        id: 3,
                        src: "img/order-gallery-13.png"
                    },
                    {
                        id: 4,
                        src: "img/order-gallery-14.png"
                    },
                    {
                        id: 5,
                        src: "img/order-gallery-15.png"
                    },
                ],
                preview_src: "img/order-preview-4.jpg"
            },
            {
                id: 2,
                title: "white",
                color_code: "#fff",
                gallery_items: [
                    {
                        id: 1,
                        src: "img/order-gallery-16.png"
                    },
                    {
                        id: 2,
                        src: "img/order-gallery-17.png"
                    },
                    {
                        id: 3,
                        src: "img/order-gallery-18.png"
                    },
                    {
                        id: 4,
                        src: "img/order-gallery-19.png"
                    },
                    {
                        id: 5,
                        src: "img/order-gallery-20.png"
                    },
                ],
                preview_src: "img/order-preview-3.jpg"
            }
        ],
        characteristics: [
            {
                id: 1,
                title: "XS",
                content: [
                    {
                        id: 1,
                        title: "Обхват груди:",
                        value: "85 см"
                    },
                    {
                        id: 2,
                        title: "Обхват талии:",
                        value: "59 см"
                    },
                    {
                        id: 3,
                        title: "Обхват бедер:",
                        value: "95 см"
                    },
                ]
            },
            {
                id: 2,
                title: "S",
                content: [
                    {
                        id: 1,
                        title: "Обхват груди:",
                        value: "85 см"
                    },
                    {
                        id: 2,
                        title: "Обхват талии:",
                        value: "59 см"
                    },
                    {
                        id: 3,
                        title: "Обхват бедер:",
                        value: "95 см"
                    },
                ]
            },
            {
                id: 3,
                title: "M",
                content: [
                    {
                        id: 1,
                        title: "Обхват груди:",
                        value: "85 см"
                    },
                    {
                        id: 2,
                        title: "Обхват талии:",
                        value: "59 см"
                    },
                    {
                        id: 3,
                        title: "Обхват бедер:",
                        value: "95 см"
                    },
                ]
            }
        ]
    }
]
assortment_list = [
    {
        id: 1,
        gallery_items: [
            {
                id: 1,
                src: "img/gallery-item.png"
            },
            {
                id: 2,
                src: "img/gallery-item-2.png"
            },
            {
                id: 3,
                src: "img/gallery-item-3.png"
            },
        ],
        characteristics: [
            {
                id: 1,
                title: "XS",
                content: [
                    {
                        id: 1,
                        title: "Высота изделия:",
                        value: "50 см"
                    },
                    {
                        id: 2,
                        title: "Ширина изделия:",
                        value: "50 см"
                    },
                    {
                        id: 3,
                        title: "Длина рукава:",
                        value: "54 см"
                    },
                ]
            },
            {
                id: 2,
                title: "S",
                content: [
                    {
                        id: 1,
                        title: "Высота изделия:",
                        value: "52 см"
                    },
                    {
                        id: 2,
                        title: "Ширина изделия:",
                        value: "52 см"
                    },
                    {
                        id: 3,
                        title: "Длина рукава:",
                        value: "52 см"
                    },
                ]
            },
            {
                id: 3,
                title: "M",
                content: [
                    {
                        id: 1,
                        title: "Высота изделия:",
                        value: "54 см"
                    },
                    {
                        id: 2,
                        title: "Ширина изделия:",
                        value: "54 см"
                    },
                    {
                        id: 3,
                        title: "Длина рукава:",
                        value: "54 см"
                    },
                ]
            }
        ],
        description: [
            {
                id: 1,
                title: "Прямой силуэт",
                text: "Свободный крой с минимальным прилеганием подойдет на любую фигуру."
            },
            {
                id: 2,
                title: "Расширенный вырез",
                text: "Горловина с отделочной строчкой придает лонгсливу аккуратный и законченный вид."
            },
            {
                id: 3,
                title: "Втачные рукава",
                text: "Манжета на запястье надежно фиксирует рукав. А естественный переход ткани от плеча к руке делает фасон завершенным."
            },
        ]
    },
    {
        id: 2,
        gallery_items: [
            {
                id: 1,
                src: "img/gallery-item-4.png"
            },
            {
                id: 2,
                src: "img/gallery-item-5.png"
            },
            {
                id: 3,
                src: "img/gallery-item-6.png"
            },
        ],
        characteristics: [
            {
                id: 1,
                title: "XS",
                content: [
                    {
                        id: 1,
                        title: "Высота изделия:",
                        value: "50 см"
                    },
                    {
                        id: 2,
                        title: "Ширина изделия:",
                        value: "50 см"
                    },
                    {
                        id: 3,
                        title: "Длина рукава:",
                        value: "54 см"
                    },
                ]
            },
            {
                id: 2,
                title: "S",
                content: [
                    {
                        id: 1,
                        title: "Высота изделия:",
                        value: "52 см"
                    },
                    {
                        id: 2,
                        title: "Ширина изделия:",
                        value: "52 см"
                    },
                    {
                        id: 3,
                        title: "Длина рукава:",
                        value: "52 см"
                    },
                ]
            },
            {
                id: 3,
                title: "M",
                content: [
                    {
                        id: 1,
                        title: "Высота изделия:",
                        value: "54 см"
                    },
                    {
                        id: 2,
                        title: "Ширина изделия:",
                        value: "54 см"
                    },
                    {
                        id: 3,
                        title: "Длина рукава:",
                        value: "54 см"
                    },
                ]
            }
        ],
        description: [
            {
                id: 1,
                title: "Полуприлегающий силуэт",
                text: "Заманчиво повторяет очертания фигуры, но не демонстрирует ее полностью. Плотнее всего топ прилегает к телу по линии талии (немного выше или ниже)."
            },
            {
                id: 2,
                title: "Удобные бретели",
                text: "Цельнокроеные широкие бретели не соскальзывают с плечей и полностью перекрывают собой лямки от бюстгальтера."
            },
            {
                id: 3,
                title: "«Правильная» резинка",
                text: "Фиксирующая лента не дает топу задираться и поддерживает грудь, но при этом не стягивает кожу. Это позволяет носить его не только дома, но и на занятиях фитнесом."
            },
        ]
    },
    {
        id: 3,
        gallery_items: [
            {
                id: 1,
                src: "img/gallery-item-7.png"
            },
            {
                id: 2,
                src: "img/gallery-item-8.png"
            },
            {
                id: 3,
                src: "img/gallery-item-9.png"
            },
        ],
        characteristics: [
            {
                id: 1,
                title: "XS",
                content: [
                    {
                        id: 1,
                        title: "Длина изделия по боковому шву:",
                        value: "98 см"
                    }
                ]
            },
            {
                id: 2,
                title: "S",
                content: [
                    {
                        id: 1,
                        title: "Длина изделия по боковому шву:",
                        value: "98 см"
                    }
                ]
            },
            {
                id: 3,
                title: "M",
                content: [
                    {
                        id: 1,
                        title: "Длина изделия по боковому шву:",
                        value: "98 см"
                    }
                ]
            }
        ],
        description: [
            {
                id: 1,
                title: "Свободный крой",
                text: "Завышенная талия делает фигуру женственной и привлекательной, не ограничивая движения. Такие брюки отлично подойдут не только в качестве любимой домашней одежды, но и для занятий спортом."
            },
            {
                id: 2,
                title: "«Правильная» резинка",
                text: "Удерживает брюки на поясе, не давая ткани соскальзывать вниз. Длина фиксирующей ленты подобрана так, чтобы не мешать сну и активному отдыху."
            },
            {
                id: 3,
                title: "Боковые карманы",
                text: "Всегда практичное дополнение к штанам. Карманы вшиты в боковые швы и выполнены в тон изделия, поэтому не акцентируют на себе лишнего внимания."
            },
        ]
    }
]

$(document).on("click", "[data-link]", function (e) {
    attr = $(this).attr("data-link")

    $(".overlay").addClass("opened")
    $(".overlay-item[data-overlay=" + attr + "]").addClass("opened")
    scrollDisable()
})

$(document).on("click", ".overlay-item__close-btn", function (e) {
    $(".overlay").find(".opened").removeClass("opened")
    $(".overlay").removeClass("opened")
    scrollEnable()
})


$(document).on("click", ".characteristics-tabs__item", function (e) {
    $(this).parent().children(".characteristics-tabs__item").removeClass("selected")
    $(this).addClass("selected")

    assortmentGalleryUpdate()
})

$(".assortment-tabs__item").on("click", function (e) {
    $(this).parent().children(".assortment-tabs__item").removeClass("selected")
    $(this).addClass("selected")

    assortmentGalleryUpdate() 
});

function assortmentGalleryUpdate() {
    selected_tab = $(".assortment-tabs").find(".selected").attr("data-tab")
    selected_characteristics = $("#assortment-characteristics").find(".selected").text()

    gallery_items = $(".assortment-gallery").find(".gallery-ul")
    paggination_items = $(".assortment-gallery").find(".paggination-ul")
    characteristics_items = $("#assortment-characteristics").parent().parent().parent().find(".characteristics-list")
    description_items = $(".assortment-description").children("ul")

    $(gallery_items).empty()
    $(paggination_items).empty()

    assortment_list[selected_tab].gallery_items.forEach(function(item) {
        if(item.id == 1) {
            gallery_items.append(`
                <li class="gallery-ul__item selected">
                    <img src="${item.src}" alt="">
                </li>
            `);

            paggination_items.append(`
                <li class="paggination-ul__item selected"></li>
            `);
        }
        if(item.id > 1) {
            gallery_items.append(`
                <li class="gallery-ul__item">
                    <img src="${item.src}" alt="">
                </li>
            `);

            paggination_items.append(`
                <li class="paggination-ul__item"></li>
            `);
        }
    });

    $(characteristics_items).empty()

    characteristics = assortment_list[selected_tab].characteristics.find(item => item.title === selected_characteristics)

    characteristics.content.forEach(function(item) {
        characteristics_items.append(`
            <li class="characteristics-list__item">
                <span>${item.title}</span>
                <span>${item.value}</span>
            </li>
        `);
    });

    $(description_items).empty()

    assortment_list[selected_tab].description.forEach(function(item) {
        description_items.append(`
            <li>
                <h4 class="assortment-description__h4">${item.title}</h4>
                <p class="assortment-description__p">${item.text}</p>
            </li>
        `);
    });
}


$(document).on("click", "[data-pagginator] .pagginator__next", function (e) {
    attr = $(this).parent().attr("data-pagginator")
    pagginator_items = $(this).parent().find(".paggination-ul").children(".paggination-ul__item")
    content_items = $("[data-paggination=" + attr + "]").children("li")

    current_index = $(this).parent().find(".selected").index()
    length = $(pagginator_items).length

    if(current_index + 1 == length) {
        $(pagginator_items).removeClass("selected")
        $(pagginator_items).eq(0).addClass("selected")

        $(content_items).removeClass("selected")
        $(content_items).eq(0).addClass("selected")
    } else {
        $(pagginator_items).removeClass("selected")
        $(pagginator_items).eq(current_index + 1).addClass("selected")

        $(content_items).removeClass("selected")
        $(content_items).eq(current_index + 1).addClass("selected")
    }
})

$(document).on("click", "[data-pagginator] .pagginator__prev", function (e) {
    attr = $(this).parent().attr("data-pagginator")
    pagginator_items = $(this).parent().find(".paggination-ul").children(".paggination-ul__item")
    content_items = $("[data-paggination=" + attr + "]").children("li")

    current_index = $(this).parent().find(".selected").index()
    length = $(pagginator_items).length

    if(current_index - 1 < 0) {
        $(pagginator_items).removeClass("selected")
        $(pagginator_items).eq(length - 1).addClass("selected")

        $(content_items).removeClass("selected")
        $(content_items).eq(length - 1).addClass("selected")
    } else {
        $(pagginator_items).removeClass("selected")
        $(pagginator_items).eq(current_index - 1).addClass("selected")

        $(content_items).removeClass("selected")
        $(content_items).eq(current_index - 1).addClass("selected")
    }
})
$(document).on("click", "[data-pagginator] .paggination-ul__item", function (e) {
    attr = $(this).parent().parent().attr("data-pagginator")
    pagginator_items = $(this).parent().children(".paggination-ul__item")
    content_items = $("[data-paggination=" + attr + "]").children("li")

    current_index = $(this).index()

    $(pagginator_items).removeClass("selected")
    $(pagginator_items).eq(current_index).addClass("selected")

    $(content_items).removeClass("selected")
    $(content_items).eq(current_index).addClass("selected")
})

$("a[href^='#']").on("click", function(event) {
    // Предотвращаем стандартное поведение ссылки (переход по якорю)
    event.preventDefault();

    // Получаем целевой блок, к которому нужно выполнить скролл
    const targetBlock = $($(this).attr("href"));
    // Проверяем, есть ли среди родителей целевого блока элемент с классом 'overlay'
    const hasOverlayAncestor = targetBlock.closest(".overlay")

    // Если есть родитель с классом 'overlay', не выполняем скролл
    if (hasOverlayAncestor) {
        $(".overlay").find(".opened").removeClass("opened")
        $(".overlay").removeClass("opened")
        scrollEnable()
    }

    // Выполняем плавный скролл к целевому блоку
    $("html, body").animate({
    scrollTop: targetBlock.offset().top
    }, 1000); // Время анимации в миллисекундах (здесь 1000 мс = 1 сек)
});

$(".carousel__prev").on("click", function(event) {
    content_list = $(this).parent().find(".carousel-list")

    items_per_page = 3

    if ($(window).width() <= 1000) {
        items_per_page = 2
    }
    if ($(window).width() <= 800) {
        items_per_page = 1
    }

    pages = Math.ceil($(content_list).children(".carousel-item").length / items_per_page)
    current_page = $(content_list).attr("data-page")

    if(current_page - 1 < 0) {
        $(content_list).css("transform", "translateX(-" + ((pages - 1) * 100) + "%)")

        $(content_list).attr("data-page", pages - 1)
    } else {
        $(content_list).css("transform", "translateX(-" + ((parseInt(current_page) - 1) * 100) + "%)")

        $(content_list).attr("data-page", parseInt(current_page) - 1)
    }
});

$(".carousel__next").on("click", function(event) {
    content_list = $(this).parent().find(".carousel-list")

    items_per_page = 3

    if ($(window).width() <= 1000) {
        items_per_page = 2
    }
    if ($(window).width() <= 800) {
        items_per_page = 1
    }

    pages = Math.ceil($(content_list).children(".carousel-item").length / items_per_page)
    current_page = $(content_list).attr("data-page")

    if((parseInt(current_page) + 1) == pages) {
        $(content_list).css("transform", "translateX(-" + 0 + "%)")

        $(content_list).attr("data-page", 0)
    } else {
        $(content_list).css("transform", "translateX(-" + ((parseInt(current_page) + 1) * 100) + "%)")

        $(content_list).attr("data-page", (parseInt(current_page) + 1))
    }
});

$(document).on("click", ".select-list__item", function (e) {
    var parent = $(this).closest(".select")

    $(this).parent().children(".select-list__item").removeClass("selected")
    $(this).addClass("selected")

    $(parent).removeClass("opened")
    $(parent).find(".select__heading span").text($(this).text())
})

function scrollDisable() {
    $("html,body").css("overflow","hidden");
}
function scrollEnable() {
    $("html,body").css("overflow","auto");
}

$(document).on("click", function(e) {
    $(".linkedCaller").each(function(item) {
        attr = $(this).attr("data-link")
    
        if($(this).is(":checked")) {
            $(".linkedContent[data-link="+attr+"]").show();
        } 
        if(!$(this).is(":checked")) {
            $(".linkedContent[data-link="+attr+"]").hide();
        }
    })
})

$(".address-list__item").on("click", function(e) {
    $(this).parent().parent().parent().find(".select-address__input").val($(this).text())
    $(this).parent().parent().parent().removeClass("opened")
})

$(".select-address__input").on("input", function(e) {
    address_list = $(this).parent().parent().find(".address-list").children(".address-list__item")
    var searchValue = $(this).val().trim().toLowerCase();

    if($(this).val() != "") {
        $(this).parent().parent().addClass("opened")

        address_list.each(function(item) {
            if($(this).text().trim().toLowerCase().includes(searchValue)) {
                $(this).show()
            } else {
                $(this).hide()
            }
        })
    } else {
        $(this).parent().parent().removeClass("opened")
    }
})



  $(".order-gallery__title").on("click", function(e) {
    $(this).parent().toggleClass("opened")
  })

$(".select__heading").on("click", function(e) {
    $(this).parent().toggleClass("opened")
})
$(".select-list__item").on("click", function(e) {
    $(this).parent().children(".select-list__item").removeClass("selected")
    $(this).addClass("selected")
})




/* Order section *Start* */

$(".order-tabs__item").on("click", function(e) {
    $(this).parent().children(".order-tabs__item").removeClass("selected")
    $(this).addClass("selected")

    orderSizesUpdate()
    orderCharacteristicsUpdate()
    orderGalleryUpdate()
    updateSummary()
})

$(document).on("click", "#order-size-list .select-list__item", function (e) {
    orderCharacteristicsUpdate()
    galleryScrollbarUpdate()
})

$(document).on("click", ".color-list__item", function (e) {
    $(this).parent().children(".color-list__item").removeClass("selected")
    $(this).addClass("selected")

    orderGalleryUpdate()
    galleryScrollbarUpdate()
})

function galleryScrollbarUpdate() {
    scrollbar_line = $(".gallery-scrollbar__line")
    current_index = $(scrollbar_line).parent().parent().find(".gallery-list").attr("data-gallery")
    length = $(scrollbar_line).parent().parent().find(".gallery-list").children(".gallery-list__item").length

    $(scrollbar_line).css("height", ((parseInt(current_index) + 1)/length) * 100 + "%")
}

$(document).ready(function (e) {
    galleryScrollbarUpdate()
})

$(".m-btn").on("click", function(e) {
    $(".m-menu").toggleClass("opened")
    $(this).toggleClass("opened")
})

function orderFormUpdate() {
    var selected_option = $("#order-tabs-list").children(".selected").text()
    var selected_size = $("#order-size-list").children(".selected").attr("data-size")
    var selected_color = $(".color-list__item.selected").attr("data-color")

    const selectedItem = order_list.find(item => item.title === selected_option);
    const sizes = foundItem.characteristics.find(item => item.title === selected_size)
    const color = foundItem.colors.find(item => item.title === selected_color)

    sizes.content.forEach(function(item) {
        sizes_list.append(`
            <li class="characteristics-list__item">
                <span>${item.title}</span>
                <span>${item.value}</span>
            </li>
        `)
    })
}

function orderCharacteristicsUpdate() {
    var selected_option = $("#order-tabs-list").children(".selected").text()
    var selected_size = $("#order-size-list").children(".selected").attr("data-size")
    var characteristics_list = $("#order-characteristics-list")

    const selectedItem = order_list.find(item => item.title === selected_option);
    const characteristics = selectedItem.characteristics.find(item => item.title === selected_size)
    console.log(selected_size)

    $(characteristics_list).empty()

    characteristics.content.forEach(function(item) {
        characteristics_list.append(`
            <li class="characteristics-list__item">
                <span>${item.title}</span>
                <span>${item.value}</span>
            </li>
        `)
    })
}

function orderSizesUpdate() {
    var selected_option = $("#order-tabs-list").children(".selected").text()
    var sizes_list = $("#order-sizes-list")

    const selectedItem = order_list.find(item => item.title === selected_option);

    $(sizes_list).empty()

    selectedItem.characteristics.forEach(function(item) {
        if(item.id == 1) {
            sizes_list.append(`
                <li class="size-list__item selected">${item.title}</li>
            `)
        }
        if(item.id > 1) {
            sizes_list.append(`
                <li class="size-list__item">${item.title}</li>
            `)
        }
    })
}

function orderGalleryUpdate() {
    var selected_option = $("#order-tabs-list").children(".selected").text()
    var selected_color = $("#order-color-list").find(".selected").attr("data-color")
    var gallery = $("#order-gallery")
    var thumbnails = $("#order-thumbnails")

    const selectedItem = order_list.find(item => item.title === selected_option);
    const color = selectedItem.colors.find(item => item.title === selected_color)

    $(gallery).empty()
    $(thumbnails).empty()

    color.gallery_items.forEach(function(item) {
        if(item.id == 1) {
            gallery.append(`
                <li class="gallery-list__item selected">
                    <img src="${item.src}" alt="">
                </li>
            `)
            thumbnails.append(`
                <li class="gallery-thumbnails__item selected">
                    <img src="${item.src}" alt="">
                </li>
            `)
        }
        if(item.id > 1) {
            gallery.append(`
                <li class="gallery-list__item">
                    <img src="${item.src}" alt="">
                </li>
            `)
            thumbnails.append(`
                <li class="gallery-thumbnails__item selected">
                    <img src="${item.src}" alt="">
                </li>
            `)
        }
    })
}

function galleryNext() {
    var gallery = $(".gallery-list")
    var height = $(gallery).children(".gallery-list__item").eq(0).height();
    var current_index = $(gallery).attr("data-gallery")
    var length = $(gallery).children(".gallery-list__item").length

    if(parseInt(current_index) + 1 >= length) {
        // $(gallery).css("transform", `translate3d(0px, -${(0) * height}px, 0px)`)
        // $(gallery).attr("data-gallery", 0)
        // galleryScrollbarUpdate()
        // updateThumbnails()
    } else {
        $(gallery).css("transform", `translate3d(0px, -${(parseInt(current_index) + 1) * height}px, 0px)`)
        $(gallery).attr("data-gallery", parseInt(current_index) + 1)
        galleryScrollbarUpdate()
        updateThumbnails()
    }
}
function galleryPrev() {
    var gallery = $(".gallery-list")
    var height = $(gallery).children(".gallery-list__item").eq(0).height();
    var current_index = $(gallery).attr("data-gallery")
    var length = $(gallery).children(".gallery-list__item").length

    if(parseInt(current_index) - 1 < 0) {
        // $(gallery).css("transform", `translate3d(0px, -${(length - 1) * height}px, 0px)`)
        // $(gallery).attr("data-gallery", (length - 1))
        // galleryScrollbarUpdate()
        // updateThumbnails()
    } else {
        $(gallery).css("transform", `translate3d(0px, -${(parseInt(current_index) - 1) * height}px, 0px)`)
        $(gallery).attr("data-gallery", parseInt(current_index) - 1)
        galleryScrollbarUpdate()
        updateThumbnails()
    }
}
function updateThumbnails() {
    $("#order-thumbnails").children(".gallery-thumbnails__item").removeClass("selected")
    $("#order-thumbnails").children(".gallery-thumbnails__item").eq(parseInt($("#order-gallery").attr("data-gallery"))).addClass("selected")
}
$(document).on("click", ".gallery-thumbnails__item", function (e) {
    gallery = $(this).parent().parent().find(".gallery-list").children(".gallery-list__item")
    var height = $(gallery).eq(0).height();

    $(gallery).parent().css("transform", `translate3d(0px, -${$(this).index() * height}px, 0px)`)
    $(gallery).parent().attr("data-gallery", $(this).index())
    $(gallery).parent().attr("data-gallery", $(this).index())

    $(this).parent().children(".gallery-thumbnails__item").removeClass("selected")
    $(this).addClass("selected")

    galleryScrollbarUpdate()
});

$(".order-gallery__wrapper").swipe({
    swipe: function (event, direction) {
        if ($(window).width() >= 1200) {
            if (direction === "up") {
                galleryNext()
            } else if (direction === "down") {
                galleryPrev()
            }
        } 
    },
    allowPageScroll: "vertical",
});

$(".order-gallery__wrapper").on("wheel", function (event) {
    if ($(window).width() >= 1200) {
        const delta = event.originalEvent.deltaY || -event.originalEvent.wheelDelta || event.originalEvent.detail;

        if (delta > 0) {
            galleryNext()
            return false;
        } else {
            galleryPrev()
            return false;
        }
    } 
});





var order_data = {
    selected_additionals: []
}

function orderDataUpdate() {
    var selected_option = $("#order-tabs-list").children(".selected").text()
    var selected_size = $("#order-size-list").children(".selected").attr("data-size")
    var selected_color = $("#order-color-list").children(".selected").attr("data-color")
    const option_price = order_list.find(item => item.title === selected_option).price;
    var selected_additionals = []
    var delivery_type = $("input[name='delivery-type']:checked").val()
    var address = ""
    var payment_type = $("input[name='payment-type']:checked").val()
    var client_name = $("#client-name").val()
    var tel = $("#tel").val()

    $("#order-additional-list").children("li").each(function(item) {
        if($(this).find('input[type="checkbox"]').prop('checked')) {
            selected_additionals.push({
                title: $(this).attr("data-additionalTitle"),
                price: $(this).attr("data-additionalPrice"),
            })
        }
    })

    switch(delivery_type) {
        case "В пункт выдачи":
            address = "test"
            break;
        case "Курьер":
            address = "test"
            break;
    }

    order_data = {
        selected_option: selected_option,
        option_price: option_price,
        selected_size: selected_size,
        selected_color: selected_color,
        selected_additionals: selected_additionals,
        delivery_type: delivery_type,
        address: address,
        payment_type: payment_type,
        client_name: client_name,
        tel: tel
    }
}

function calculateSummary() {
    sum = 0

    sum += parseFloat(order_data.option_price)

    order_data.selected_additionals.forEach(item => {
        sum += parseFloat(item.price);
    });

    return sum
}

function updateSummary() {
    $(".order-price span:last-child").text(calculateSummary() + " РУБ.")
    $("#summary-price").text(calculateSummary() + " РУБ.")
}

$(".additional-list__item").on("click", function(e) {
    orderDataUpdate()
    updateSummary()
})

$("#place-order").on("click", function(e) {
    orderDataUpdate()
    updateCheckout()

    const selected_option = order_list.find(item => item.title === order_data.selected_option);
    const selected_color = selected_option.colors.find(item => item.title === order_data.selected_color);

    $(".order-overlay__left").children("img").attr("src", selected_color.preview_src)
})

function updateCheckout() {
    var summary_list = $(".summary-list")
    var summary_price = $(".order-overlay").find(".order-price span:last-child")

    $(summary_list).empty()

    $(summary_list).append(`
        <li class="summary-list__item">
            <span class="summary-list__title">
                ${order_data.selected_option}
            </span>
            <span class="summary-list__price">${order_data.option_price} РУБ.</span>
        </li>
    `)

    order_data.selected_additionals.forEach(function(item) {
        $(summary_list).append(`
            <li class="summary-list__item">
                <span class="summary-list__title">
                    ${item.title}
                </span>
                <span class="summary-list__price">${item.price} РУБ.</span>
            </li>
        `)
    })

    updateSummary()
}

$(document).on("click", ".summary-list__item", function (e) {
    if($(this).is(":first-child")) {
        return false
    } else {
        order_data.selected_additionals.splice(($(this).index() - 1), 1);
        $(this).remove()
        updateSummary()
    }
})

$(document).on("click", "#order-checkout", function (e) {
    orderDataUpdate()
    return false;
})


/* Order section *Stop* */

$(".size-ranges__range").on("input", function(e) {
    const sizeTable = [
        { size: "42/XS", chest: [82, 85], waist: [64, 68], hips: [91, 94] },
        { size: "44/S", chest: [86, 89], waist: [68, 72], hips: [95, 98] },
        { size: "46/M", chest: [90, 93], waist: [72, 76], hips: [99, 102] },
        { size: "48/L", chest: [94, 97], waist: [76, 80], hips: [103, 106] },
    ];

    var chest_size = parseFloat($('[data-range="chest"]').children(".size-ranges__range").val());
    var waist_size = parseFloat($('[data-range="waist"]').children(".size-ranges__range").val());
    var hips_size = parseFloat($('[data-range="hips"]').children(".size-ranges__range").val());

    $('[data-range="chest"]').children(".size-ranges__value").text(chest_size + "см")
    $('[data-range="waist"]').children(".size-ranges__value").text(waist_size + "см")
    $('[data-range="hips"]').children(".size-ranges__value").text(hips_size + "см")

    var closestSize = null;
    var minDistance = Number.MAX_SAFE_INTEGER;

    for (var i = 0; i < sizeTable.length; i++) {
        var sizeData = sizeTable[i];
        var chestDistance = Math.abs((sizeData.chest[0] + sizeData.chest[1]) / 2 - chest_size);
        var waistDistance = Math.abs((sizeData.waist[0] + sizeData.waist[1]) / 2 - waist_size);
        var hipsDistance = Math.abs((sizeData.hips[0] + sizeData.hips[1]) / 2 - hips_size);
        
        var totalDistance = chestDistance + waistDistance + hipsDistance;

        if (totalDistance < minDistance) {
            minDistance = totalDistance;
            closestSize = sizeData.size;
        }
    }

    $(".size-result__value").text(closestSize);
});

$('[data-checkbox]').on('change', function() {
    var dataAttrValue = $(this).data('checkbox'); // Значение атрибута data-checkbox

    // Находим все checkbox'ы с тем же атрибутом и устанавливаем им такое же состояние
    $('[data-checkbox="' + dataAttrValue + '"]').prop('checked', $(this).prop('checked'));
});

$('input[type="checkbox"]').on('change', function() {
    updateSummary()
});


$(document).ready(function (e) {
    orderDataUpdate()
    updateSummary()
    if ($(window).width() >= 800) {
        $(".order-gallery__wrapper").css("height", $(".gallery-list__item.selected").outerHeight());
    }
})